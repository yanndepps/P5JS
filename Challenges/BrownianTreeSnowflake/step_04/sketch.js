let generatedImg;

function setup() {
  createCanvas(400, 400);
  generateImage();
  let button = createButton('generate');
  button.mousePressed(generateImage);
}


function generateImage() {
  const z = [];
  for (let i = 0; i < 512; i++) {
    z[i] = random(-1, 1);
  }
  
  // const z = [-0.11154777755274205, -0.21485983069505848, -0.34377926963861144, -0.23141510612260763, 0.13057834503977378, -0.007855446401024906, 0.048932047900271086, -0.02716666961659006, -0.27045655910547495, 0.21902778608775247, 0.0010320792784021537, -0.07430405402844872, -0.1911494618228209, 0.06683951429559051, 0.030771943053410536, 0.14309780324685356, -0.25184284301911897, -0.012712692867628744, -0.03301548118772199, 0.20504086453498976, 0.05210332181410306, -0.10742533538237864, 0.09554905621080562, 0.10573784544432033, -0.041691563875028835, -0.00010616613443225481, 0.09421485900334964, 0.13483334335203204, 0.1353767839892159, 0.1965000925520076, -0.06152372293267609, -0.15211175139656513, -0.1540067191619862, 0.07448530550775621, 0.06359137118141645, 0.006305284330464105, 0.09277918048986761, -0.13416219619113717, -0.15959852269925034, 0.20181299493529628, 0.2020122588361178, 0.016858477742198806, 0.09221260668256674, 0.041140535541809076, -0.008392686942144664, 0.21610596290289252, 0.05476906243607914, -0.11033360603356665, 0.10507258523113441, -0.019612306478809988, -0.18539835845830832, 0.043144075396482795, -0.14612502165527713, -0.061113087889956244, 0.3183901297926046, -0.19622379997660438, 0.07447455353218684, -0.07236670386854899, -0.18610774692051285, -0.00992234999991249, -0.0299131989561794, 0.07923868701270555, 0.2366957983057274, -0.15705824099346127, 0.12753812278895604, -0.03578951042754079, 0.1770531091966469, -0.029972749310776405, 0.09900829511346049, -0.3247899923476708, -0.01600622204696181, 0.0897941875755998, 0.005560045695931819, 0.21099647795605603, -0.14512929347357656, -0.021800272042275404, -0.15998430582511797, 0.04096736610517315, -0.0338921763686051, 0.2009935291610936, -0.001256495761178436, 0.07037704943083306, -0.12820614328574778, 0.034975641254831345, -0.10105818692266459, -0.10777567057335997, -0.06007900309811951, 0.0673311244808712, -0.16743955398262456, 0.12152660685342709, 0.1544021038536804, 0.06824724676876294, -0.06416236970125126, 0.4341224480284859, 0.07495609244235851, -0.06042858404285483, -0.014805842902018251, -0.1066290247036777, -0.24484720027548126, -0.2499993807015281, -0.042985226575103105, -0.030175555306147878, 0.03412952745252363, -0.1838308739993021, -0.08384644474463246, 0.0249328429633138, 0.18419676289764414, 0.033836671047841514, -0.1626535343424862, 0.0692603179713242, 0.10462280620734517, 0.08851603819320746, -0.005199077671905583, -0.03859458307088811, -0.3533547069035282, 0.14637939669494407, -0.023054716254116744, -0.1426165307184982, -0.14597875916191738, -0.07709340293897189, 0.16570561827901212, -0.11082864606661288, 0.0015248062381229555, -0.09661573205634028, 0.06379259521148656, 0.059101689462897886, -0.04865545770142058, -0.1328638828682929, -0.0882158559084756, 0.10352972016981407, -0.08404569836173177, -0.37489550913178216, 0.05011472214630089, 0.03590493676051968, -0.1698318466396272, -0.16162443747177507, 0.2856314950894342, -0.18144554784122408, 0.14262696177605722, -0.025098828811986107, -0.12581167729853665, -0.07433779024572362, -0.09057611769228946, -0.13062595965620624, -0.03303541243048318, -0.1471385938074882, -0.07419691299801381, 0.1692301141188139, -0.046512028730326394, -0.030645789977241225, -0.23350972162200723, -0.026265934494264224, 0.14326885381841303, -0.05456885265946497, -0.23215596661637325, -0.1741284780763566, -0.21489634247761027, -0.023536026785383607, 0.05735562440574425, -0.06251853744970882, 0.3294790662532141, -0.16470442222915693, 0.02161012767082695, 0.004455703005893583, -0.08174632237083734, -0.038793867236488894, 0.013388099539822812, 0.09576562444126487, -0.09307691365026795, -0.092339390734791, 0.21691211582278272, -0.04161995380534761, 0.053929240808544145, 0.029432754789498833, 0.0028114321937845604, 0.14438663457375844, -0.07184242544067929, 0.04366318113715941, 0.2179964710423217, 0.23496206320825835, 0.13568595263286407, -0.19797409039388592, -0.03155665719746621, -0.3022547512573681, -0.0736501589145005, -0.12874456141568089, -0.04953538125368684, -0.27134319330224843, -0.014260718952708197, 0.1301650023217628, 0.017405195208335417, -0.11271951900107628, 0.07910316482061061, -0.26181399110006687, -0.085396650832255, -0.18401304086629822, 0.00830137899183243, 0.04712227122420819, -0.01422617307599175, -0.02667259981452748, 0.1663487826397078, 0.2947976231987219, 0.08574874956841509, 0.07726591838737511, 0.06548141456427722, -0.417562503838539, -0.021675682900520327, 0.09697259378540679, -0.013632766704072992, 0.18361765270603495, 0.28675884024384785, -0.0010702803087662277, -0.11750658311108166, -0.07710192349516402, -0.03459994620796113, 0.014171592229470856, 0.053526286344255186, -0.1870520624179882, -0.08369108269858026, -0.07152037824659485, 0.42667721965640437, -0.06044463049302028, -0.14102591966390032, 0.40431724092009425, 0.0293997316441712, -0.0019409312403391, 0.29151379444490333, -0.032024478104571555, 0.007757959991313592, 0.05473778743276648, -0.007363433971900559, 0.04415955825183983, 0.16685675794005816, 0.00005825628462862581, -0.18991859516049658, -0.1235351437790271, 0.2822014620597632, -0.07021705344531456, 0.09825205378798513, 0.2748138014652878, -0.22929151497608447, -0.2537536604959391, -0.07668136808953403, 0.32848372403693943, 0.023745438573402805, -0.135510041400646, -0.05518233777133755, 0.1774030992343973, 0.16277045189725595, 0.1004736896995514, 0.23892451214694382, 0.12304982542079676, 0.028089411099509163, -0.12588453775549285, -0.16663075971858254, -0.00009015207433885064, 0.03590574599680174, -0.04311460100744462, 0.03789145129919566, -0.3824683286665182, -0.29275841770197814, -0.24927530262586578, 0.00980485770181666, -0.0463307962078707, -0.15835868604493417, -0.11396246424075784, 0.07063148922374946, -0.013814195282829126, 0.2001850177056171, -0.09151210920176829, -0.09586199475862038, 0.08394664016866626, -0.3674741491903783, -0.22478606329996262, -0.2631608952142157, -0.16843792129567048, -0.15097863690094693, 0.3543547552465204, -0.05983243689065744, -0.05181697094407675, -0.11190170990416104, -0.09688452411590391, -0.03907357448575119, 0.2152001591186764, -0.013849330616552651, 0.08274982952458429, 0.1246337692447452, 0.057401158449146034, -0.07540215550092613, -0.11235993974687798, -0.2145582242704815, 0.052354636491817576, -0.2757764791354296, -0.1299546262893629, -0.43014867589208444, 0.20260647342759616, 0.382618232900664, 0.0821017222918464, -0.42672573608247744, 0.17571909278560213, -0.11424788853782794, -0.04090085479874317, -0.2753127603753581, -0.1044456635247971, 0.0850486164452233, -0.39177475196161193, 0.22541687276119837, 0.0879831624483971, -0.1123307120965965, -0.0010635542227312514, 0.05123138042609973, -0.006320439621174373, -0.21847308537830507, 0.047252651052286605, -0.010454766521943194, 0.06237019903699445, -0.0022163475618197995, 0.06291680956512025, 0.08704622891272214, -0.21348865795644673, 0.0039149120814206935, -0.25472928127138794, -0.11236978968685889, 0.22521009815938994, 0.08133311621535733, -0.20034102592433561, -0.08773850241211374, 0.09061749916246879, -0.05969164399972572, -0.01205523663220313, -0.026956606626378922, -0.30049400227815004, -0.06716029662928072, -0.19607266752638147, -0.09927084689821525, -0.22208280013873638, -0.026476417922553876, -0.006184116162485959, 0.08898340795419765, 0.06425032065635071, -0.06335875423760173, 0.08264210054282942, 0.21348303799480878, 0.1330209071370338, 0.275745968458713, -0.22009723573335957, 0.12503468244964003, 0.10010385535226596, -0.10148301061963441, -0.13865554519980383, -0.017521744708211766, -0.08823252242880966, -0.08214119646866024, -0.024343157890935947, 0.022566529250418535, -0.31827187647440447, 0.11033088633240488, 0.158182632409139, -0.23912784476401608, 0.23289470914096677, 0.15571816828518642, -0.04798358332044509, 0.021188497141484436, 0.04786919732644748, 0.10299136381732277, 0.06542356621034881, -0.05448639098855268, 0.09470480505410572, 0.11295972542607319, -0.07967901589290127, 0.15877016603921879, 0.06213789678333957, 0.07465544690674425, -0.031500718079554194, 0.1332368180287848, -0.22869698731007643, -0.1075110206786269, -0.03466079540233852, 0.19292518528840746, 0.20083914271107361, -0.0421714739843425, -0.021053680102764233, 0.21618960253696645, 0.14452704237526567, 0.3675525621860171, 0.36731790462724345, -0.08794973890014007, 0.33219346553143264, -0.10295368134492684, 0.05640329963319255, 0.038935355055360894, 0.23026434283840036, 0.04225380991245595, 0.0951792405858305, 0.24334313066146301, 0.07703387412634821, 0.060263775738098144, -0.05883534376362218, -0.07115622860234622, 0.08602961797205405, -0.02100347746779109, -0.32203771765007605, -0.02602328549911402, -0.10943343481884996, -0.13743017731585533, 0.07778028124806624, -0.09763410851633585, 0.2613223514244157, 0.13062260197254166, 0.060341112564167576, 0.08398257123116808, 0.011200837339941885, 0.09140708063880351, 0.14237974264539266, 0.24938445378142526, 0.13704358836033304, -0.1431315032475485, -0.09163115767127752, 0.09985266041364473, -0.13904446535901896, 0.02195552793750833, -0.31235374604751603, 0.2480513144925321, 0.05046392067441611, -0.16972967681471182, 0.0028330198994532055, 0.27460578441005173, 0.23145468977023143, 0.057317992909976474, -0.15291349160109302, -0.09284195023811491, -0.07314482042003667, -0.11110029032677313, 0.07385556324548917, -0.08449051501277406, 0.12691736388878083, -0.12618499312113957, 0.16766207562182642, 0.15848078994428214, 0.06163784019873935, 0.2197956029537323, -0.32370591822891326, -0.08312305121983421, -0.05508252927156453, -0.06575510262359645, 0.16245926544771738, -0.06087962102225919, 0.21071150947932907, 0.2992064045370696, -0.04219527761673486, -0.07235729922906144, 0.10812996747284037, -0.0416168869661511, 0.14809858668376116, -0.1070680336469666, 0.14334908887200415, 0.24540285812985216, 0.16604549960186854, -0.19110967121643574, 0.1371186124563732, -0.1509337141464049, 0.016385766035299884, 0.10263295798598886, -0.2957395365073934, 0.11301909588634199, -0.03971990196733839, -0.13495842186017934, 0.154030036514474, -0.005107625843997227, 0.21272030351085358, -0.015893834985249287, 0.13619713127187008, -0.2366189403261938, -0.2221233176742738, -0.14994510443148168, 0.13753334601004616, 0.04606204386838478, 0.11181407875555749, -0.05497311878326805, -0.05325602946792046, -0.28802230711117216, 0.15323556952992157, -0.10399834108676946, 0.18311900446231374, -0.205634460534292, -0.14760541166906715, 0.10749329648870137, -0.1740257923644506, 0.02643665924653804, 0.09528272189218594, -0.23602243985103524, -0.0849426180936685, -0.1612121617478424, -0.3559822151646114, 0.21951283177715764, 0.03641796203088972, -0.10501392307123342, -0.02027880180645051, 0.1025110732385926, 0.24378455322566217, 0.044590250781664294, 0.13457627504199313, -0.045603960821439166, -0.1105363602756173, -0.15135596852599656, 0.17033832419157288, -0.13615892028005197, -0.25765794386227475, -0.03759735147020701, 0.26240146795268576, 0.010138632472850897, 0.262657707753083];
  const path = "http://localhost:8000/query";
  const data = {
    z: z,
    truncation: 0.5
  };
  // httpPost(path, [datatype], [data], [callback], [errorCallback])
  httpPost(path, 'json', data, gotImage, gotError);
}

function gotError(error) {
  console.error(error);
}

function gotImage(result) {
  generatedImg = createImg(result.image);
  generatedImg.hide();
}


function draw() {
  background(0);
  if (generatedImg) {
    image(generatedImg, 0, 0, width, height);
  }
}
